# üìÆ JSON Complets pour Postman - Avec R√¥les

## ‚úÖ Tous les JSON Pr√™ts √† l'Emploi

---

## 1Ô∏è‚É£ INSCRIPTION - Candidat

**Endpoint :** `POST http://localhost:8000/api/auth/register`  
**Headers :** `Content-Type: application/json`

```json
{
  "email": "candidat@test.com",
  "password": "Password123!",
  "password_confirmation": "Password123!",
  "nom": "Dupont",
  "prenom": "Jean",
  "contact": "0612345678",
  "adresse": "123 Avenue des Champs-√âlys√©es, 75008 Paris",
  "role": "candidat"
}
```

**R√©ponse Attendue (201) :**
```json
{
  "success": true,
  "message": "Inscription r√©ussie. Bienvenue !",
  "user": {
    "id": "uuid-xxx",
    "email": "candidat@test.com",
    "role": "candidat"
  },
  "access_token": "eyJhbGc...",
  "refresh_token": "eyJhbGc...",
  "token_type": "Bearer",
  "expires_in": 3600
}
```

---

## 2Ô∏è‚É£ INSCRIPTION - Responsable Auto-√âcole

```json
{
  "email": "responsable@autoecole.com",
  "password": "SecurePass123!",
  "password_confirmation": "SecurePass123!",
  "nom": "Martin",
  "prenom": "Sophie",
  "contact": "0698765432",
  "adresse": "15 Rue de la Formation, 69001 Lyon",
  "role": "responsable_auto_ecole"
}
```

**‚úÖ Utilisateur ajout√© au groupe :** "Responsables Auto-√âcole"

---

## 3Ô∏è‚É£ INSCRIPTION - Administrateur

```json
{
  "email": "admin@systeme.com",
  "password": "AdminPass123!",
  "password_confirmation": "AdminPass123!",
  "nom": "Durand",
  "prenom": "Pierre",
  "contact": "0601020304",
  "adresse": "1 Place de la R√©publique, 75011 Paris",
  "role": "admin"
}
```

**‚úÖ Utilisateur ajout√© au groupe :** "Administrateurs"

---

## 4Ô∏è‚É£ CONNEXION

**Endpoint :** `POST http://localhost:8000/api/auth/login`  
**Headers :** `Content-Type: application/json`

```json
{
  "email": "candidat@test.com",
  "password": "Password123!"
}
```

**R√©ponse Attendue (200) :**
```json
{
  "success": true,
  "message": "Connexion r√©ussie. Bienvenue !",
  "user": {
    "id": "uuid-xxx",
    "email": "candidat@test.com",
    "role": "candidat"
  },
  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "Bearer",
  "expires_in": 3600
}
```

**üíæ Sauvegarder les tokens pour les tests suivants !**

---

## 5Ô∏è‚É£ PROFIL UTILISATEUR

**Endpoint :** `GET http://localhost:8000/api/auth/me`  
**Headers :** 
```
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

**R√©ponse Attendue (200) :**
```json
{
  "success": true,
  "user": {
    "id": "uuid-xxx",
    "email": "candidat@test.com",
    "role": "candidat",
    "personne": {
      "id": "uuid-yyy",
      "nom": "Dupont",
      "prenom": "Jean",
      "email": "candidat@test.com",
      "contact": "0612345678",
      "adresse": "123 Avenue des Champs-√âlys√©es, 75008 Paris"
    },
    "created_at": "2025-10-22T23:00:00.000000Z",
    "updated_at": "2025-10-22T23:00:00.000000Z"
  }
}
```

---

## 6Ô∏è‚É£ D√âCONNEXION

**Endpoint :** `POST http://localhost:8000/api/auth/logout`  
**Headers :** 
```
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json
```

**Body :**
```json
{
  "refresh_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**R√©ponse Attendue (200) :**
```json
{
  "success": true,
  "message": "D√©connexion r√©ussie. √Ä bient√¥t !"
}
```

---

## 7Ô∏è‚É£ RAFRA√éCHIR TOKEN

**Endpoint :** `POST http://localhost:8000/api/auth/refresh`  
**Headers :** `Content-Type: application/json`

```json
{
  "refresh_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**R√©ponse Attendue (200) :**
```json
{
  "success": true,
  "message": "Token rafra√Æchi avec succ√®s.",
  "access_token": "eyJhbGc...",
  "refresh_token": "eyJhbGc...",
  "token_type": "Bearer",
  "expires_in": 3600
}
```

---

## üéØ Workflow Complet de Test

### √âtape 1 : Inscription

```json
POST http://localhost:8000/api/auth/register

{
  "email": "test.workflow@gmail.com",
  "password": "Workflow123!",
  "password_confirmation": "Workflow123!",
  "nom": "Workflow",
  "prenom": "Test",
  "contact": "0600000000",
  "role": "candidat"
}
```

**üíæ COPIER les tokens retourn√©s !**

---

### √âtape 2 : V√©rifier dans Authentik

```
http://5.189.156.115:31015

Directory ‚Üí Users ‚Üí test.workflow@gmail.com
‚Üí Active: Oui ‚úÖ
‚Üí Groups: Candidats ‚úÖ
```

---

### √âtape 3 : Connexion

```json
POST http://localhost:8000/api/auth/login

{
  "email": "test.workflow@gmail.com",
  "password": "Workflow123!"
}
```

**‚úÖ Devrait retourner les tokens !**

---

### √âtape 4 : Profil

```
GET http://localhost:8000/api/auth/me
Authorization: Bearer {access_token_de_l_√©tape_3}
```

---

### √âtape 5 : D√©connexion

```json
POST http://localhost:8000/api/auth/logout
Authorization: Bearer {access_token_de_l_√©tape_3}

{
  "refresh_token": "{refresh_token_de_l_√©tape_3}"
}
```

---

### √âtape 6 : V√©rifier R√©vocation

```
GET http://localhost:8000/api/auth/me
Authorization: Bearer {m√™me_access_token}
```

**R√©sultat attendu :** ‚ùå 401 Unauthorized (token r√©voqu√©)

---

## üìã Tous les R√¥les Disponibles

| R√¥le | Valeur JSON | Groupe Authentik |
|------|-------------|------------------|
| Candidat | `"role": "candidat"` | Candidats |
| Responsable | `"role": "responsable_auto_ecole"` | Responsables Auto-√âcole |
| Admin | `"role": "admin"` | Administrateurs |

---

## üß™ Collection Postman Compl√®te

### Variables d'Environnement

```
base_url = http://localhost:8000/api
access_token = (sera rempli apr√®s login)
refresh_token = (sera rempli apr√®s login)
```

### Requ√™tes

**1. Register Candidat**
```
POST {{base_url}}/auth/register
Body: JSON ci-dessus avec role: "candidat"
```

**2. Register Responsable**
```
POST {{base_url}}/auth/register
Body: JSON ci-dessus avec role: "responsable_auto_ecole"
```

**3. Register Admin**
```
POST {{base_url}}/auth/register
Body: JSON ci-dessus avec role: "admin"
```

**4. Login**
```
POST {{base_url}}/auth/login
Tests: Set {{access_token}} = response.access_token
```

**5. Me**
```
GET {{base_url}}/auth/me
Headers: Authorization: Bearer {{access_token}}
```

**6. Logout**
```
POST {{base_url}}/auth/logout
Headers: Authorization: Bearer {{access_token}}
Body: { "refresh_token": "{{refresh_token}}" }
```

**7. Refresh**
```
POST {{base_url}}/auth/refresh
Body: { "refresh_token": "{{refresh_token}}" }
```

---

## ‚ö†Ô∏è Erreurs de Validation

### Email Manquant

```json
{
  "password": "Password123!",
  "password_confirmation": "Password123!",
  "nom": "Test",
  "prenom": "User",
  "contact": "0600000000",
  "role": "candidat"
}
```

**Erreur (422) :**
```json
{
  "success": false,
  "message": "Erreur de validation des donn√©es.",
  "errors": {
    "email": ["L'adresse email est obligatoire."]
  }
}
```

---

### R√¥le Invalide

```json
{
  "email": "test@test.com",
  "password": "Password123!",
  "password_confirmation": "Password123!",
  "nom": "Test",
  "prenom": "User",
  "contact": "0600000000",
  "role": "super_admin"
}
```

**Erreur (422) :**
```json
{
  "success": false,
  "message": "Erreur de validation des donn√©es.",
  "errors": {
    "role": ["Le r√¥le s√©lectionn√© n'est pas valide. Valeurs autoris√©es : admin, responsable_auto_ecole, candidat."]
  }
}
```

---

### R√¥le Omis (Par D√©faut = candidat)

```json
{
  "email": "test@test.com",
  "password": "Password123!",
  "password_confirmation": "Password123!",
  "nom": "Test",
  "prenom": "User",
  "contact": "0600000000"
}
```

**‚úÖ Inscription r√©ussie avec role = "candidat" par d√©faut**

---

## üéØ JSON Recommand√©s pour Vos Tests

### Test 1 : Candidat (R√¥le par d√©faut)

```json
{
  "email": "candidat.test@gmail.com",
  "password": "Candidat123!",
  "password_confirmation": "Candidat123!",
  "nom": "Candidat",
  "prenom": "Test",
  "contact": "0600000001",
  "adresse": "1 Rue du Candidat",
  "role": "candidat"
}
```

### Test 2 : Responsable Auto-√âcole

```json
{
  "email": "responsable.test@gmail.com",
  "password": "Responsable123!",
  "password_confirmation": "Responsable123!",
  "nom": "Responsable",
  "prenom": "Test",
  "contact": "0600000002",
  "adresse": "2 Rue du Responsable",
  "role": "responsable_auto_ecole"
}
```

### Test 3 : Administrateur

```json
{
  "email": "admin.test@gmail.com",
  "password": "Admin123!",
  "password_confirmation": "Admin123!",
  "nom": "Admin",
  "prenom": "Test",
  "contact": "0600000003",
  "adresse": "3 Rue de l'Admin",
  "role": "admin"
}
```

---

## üîÑ Connexion pour Chaque R√¥le

### Connexion Candidat

```json
{
  "email": "candidat.test@gmail.com",
  "password": "Candidat123!"
}
```

### Connexion Responsable

```json
{
  "email": "responsable.test@gmail.com",
  "password": "Responsable123!"
}
```

### Connexion Admin

```json
{
  "email": "admin.test@gmail.com",
  "password": "Admin123!"
}
```

---

## ‚úÖ V√©rification des Groupes dans Authentik

Apr√®s chaque inscription, v√©rifiez :

```
Authentik ‚Üí Directory ‚Üí Groups

Candidats
‚îî‚îÄ candidat.test@gmail.com ‚úÖ

Responsables Auto-√âcole
‚îî‚îÄ responsable.test@gmail.com ‚úÖ

Administrateurs
‚îî‚îÄ admin.test@gmail.com ‚úÖ
```

---

## üìä Champs Obligatoires vs Optionnels

| Champ | Type | Obligatoire | Valeur par d√©faut |
|-------|------|-------------|-------------------|
| `email` | string | ‚úÖ Oui | - |
| `password` | string (min 8) | ‚úÖ Oui | - |
| `password_confirmation` | string | ‚úÖ Oui | - |
| `nom` | string | ‚úÖ Oui | - |
| `prenom` | string | ‚úÖ Oui | - |
| `contact` | string | ‚úÖ Oui | - |
| `adresse` | string | ‚ùå Non | null |
| `role` | enum | ‚ùå Non | "candidat" |

---

## üéØ JSON Minimal (Sans R√¥le)

Si vous omettez le r√¥le, il sera automatiquement **"candidat"** :

```json
{
  "email": "simple@test.com",
  "password": "Simple123!",
  "password_confirmation": "Simple123!",
  "nom": "Simple",
  "prenom": "User",
  "contact": "0600000000"
}
```

**‚úÖ R√©sultat :** Utilisateur cr√©√© avec `role: "candidat"`

---

## üìù R√©capitulatif des R√¥les

### Candidat
```json
"role": "candidat"
```
- **Groupe Authentik :** Candidats
- **Usage :** Candidats au permis de conduire
- **Permissions :** Voir ses dossiers, modifier son profil

### Responsable Auto-√âcole
```json
"role": "responsable_auto_ecole"
```
- **Groupe Authentik :** Responsables Auto-√âcole
- **Usage :** G√©rants d'auto-√©cole
- **Permissions :** G√©rer formations, dossiers, candidats

### Administrateur
```json
"role": "admin"
```
- **Groupe Authentik :** Administrateurs
- **Usage :** Administration syst√®me
- **Permissions :** Toutes permissions

---

## üß™ Test Rapide Complet

**Copiez-collez ce JSON dans Postman :**

### Inscription

```json
{
  "email": "test.complet@gmail.com",
  "password": "TestComplet123!",
  "password_confirmation": "TestComplet123!",
  "nom": "Complet",
  "prenom": "Test",
  "contact": "0612345678",
  "adresse": "123 Rue du Test",
  "role": "candidat"
}
```

### Connexion (Utilisez le M√äME mot de passe)

```json
{
  "email": "test.complet@gmail.com",
  "password": "TestComplet123!"
}
```

**‚úÖ Devrait fonctionner !**

---

## üîç V√©rification

Apr√®s inscription, v√©rifiez dans Authentik :

```
http://5.189.156.115:31015

Directory ‚Üí Users ‚Üí test.complet@gmail.com
‚îú‚îÄ Email: test.complet@gmail.com ‚úÖ
‚îú‚îÄ Name: Test Complet ‚úÖ
‚îú‚îÄ Active: Oui ‚úÖ
‚îú‚îÄ Groups: [Candidats] ‚úÖ
‚îî‚îÄ Attributes:
   ‚îú‚îÄ role: candidat ‚úÖ
   ‚îú‚îÄ contact: 0612345678 ‚úÖ
   ‚îú‚îÄ adresse: 123 Rue du Test ‚úÖ
   ‚îú‚îÄ nom: Complet ‚úÖ
   ‚îî‚îÄ prenom: Test ‚úÖ
```

---

## üéä R√©sum√©

**Tous les JSON incluent maintenant le champ `role` !**

- ‚úÖ `role: "candidat"` ‚Üí Groupe "Candidats"
- ‚úÖ `role: "responsable_auto_ecole"` ‚Üí Groupe "Responsables Auto-√âcole"
- ‚úÖ `role: "admin"` ‚Üí Groupe "Administrateurs"
- ‚úÖ R√¥le par d√©faut si omis : "candidat"

**Testez maintenant avec Postman ! üöÄ**

